name: Daily Green Commit

on:
  schedule:
    - cron: '0 */1 * * *'
  workflow_dispatch:

jobs:
  commit:
    runs-on: ubuntu-latest
    env:
      TZ: Asia/Shanghai

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GCGH159 }}

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Make a commit
        run: |
          git config user.name  "GCGH159"
          git config user.email "2932582566@QQ.com"


          TIMESTAMP="$(date '+%Y-%m-%d %H:%M:%S')"

          echo "$TIMESTAMP - auto commit" >> auto-log.md
          echo "Commit count: $(( $(wc -l < auto-log.md 2>/dev/null || echo 0) ))" >> auto-log.md


          mkdir -p logs
          echo "$TIMESTAMP" >> "logs/log-$(date '+%Y-%m').md"

          echo "Last update: $TIMESTAMP" > stats.txt
          echo "Total commits: $(git rev-list --count HEAD 2>/dev/null || echo 0)" >> stats.txt


          echo "Random: $RANDOM" >> data.txt


          git add auto-log.md logs/ stats.txt data.txt
          git commit -m "chore: daily auto update $(date '+%Y-%m-%d %H:%M')"
          git push
